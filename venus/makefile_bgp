
PROG =	venus.x

SRCS =  ./src/modules.f ./src/main.f ./src/emperor.f ./src/datain.f \
./src/outputleman.f ./src/outputterp.f  ./src/extrap.f \
./src/rand.f ./src/array.f ./src/makeinputrandom.f \
./src/interpolation.f ./src/updatenu.f \
./src/moments.f ./src/distfun.f ./src/findsigma.f ./src/inputvmec.f ./src/inputleman.f \
./src/solverRK.f ./src/systEDO.f ./src/rungekutta2.f ./src/rungekuttamixte.f ./src/rungekutta4mixte.f ./src/systEDOmixte.f \
./src/changepitch.f ./src/airy.f ./src/makekicks.f ./src/varstep.f \
./src/walltime.f


OBJS = ./obj/modules.o ./obj/main.o ./obj/emperor.o ./obj/datain.o \
./obj/outputleman.o ./obj/outputterp.o ./obj/extrap.o \
./obj/rand.o ./obj/array.o ./obj/makeinputrandom.o \
./obj/interpolation.o ./obj/updatenu.o \
./obj/moments.o ./obj/distfun.o ./obj/findsigma.o ./obj/inputvmec.o ./obj/inputleman.o \
./obj/solverRK.o ./obj/systEDO.o ./obj/rungekutta2.o ./obj/rungekuttamixte.o ./obj/rungekutta4mixte.o ./obj/systEDOmixte.o \
./obj/changepitch.o ./obj/airy.o ./obj/makekicks.o ./obj/varstep.o \
./obj/walltime.o
 
BGP_FLOOR = /bgsys/drivers/ppcfloor

BGCC      = $(BGP_FLOOR)/comm/bin/mpixlc_r
BGCPP     = $(BGP_FLOOR)/comm/bin/mpixlcxx_r
BGF90     = $(BGP_FLOOR)/comm/bin/mpixlf90_r
BGFC      = $(BGP_FLOOR)/comm/bin/mpixlf77_r

HDF5=/bgsys/hdf5-1.8.3
FUTILS      = ./futils/src

BGFLAGS   = -qarch=450 -qtune=450 -I ./ -I${HOME}/fftw-2.1.5/include \
            -I$(BGP_FLOOR)/comm/include -I/bgsys/include


CC     = $(BGCC)	
FC     = $(BGFC)
FFLAGS = -qrealsize=8 $(BGFLAGS) -qmoddir=./mods/ -I./mods/ -I./interpos \
         -I$(HDF5)/include -I$(FUTILS)

LDFLAGS = -Wl,--allow-multiple-definition -L$(FUTILS) -L/bgsys/lib  -L$(HDF5)/lib
LIBS = -llapack -lesslbg -lfutils -lhdf5_fortran -lhdf5 -lc -lresolv

all: $(PROG)

$(PROG): $(OBJS)
	$(FC) $(LDFLAGS) -o $@ $(OBJS) \
        ./interpos/interpos.o ./infnan/infnan.o \
        $(LIBS)
#./src/walltime.o \
#./interpos/varlaprout2.o ./interpos/varlaprout.o ./infnan/infnan.o

clean:
	rm -f $(PROG) $(OBJS) ./mods/* 
	ln -s ../interpos/interpos.mod ./mods/
	ln -s ../infnan/inf_nan_detection.mod ./mods/
#	ln -s ../interpos/interpos.o ./obj/

.SUFFIXES: 

$(OBJS):
	$(FC) $(FFLAGS)  -c -o $@ ./src/$(@F:.o=.f)


